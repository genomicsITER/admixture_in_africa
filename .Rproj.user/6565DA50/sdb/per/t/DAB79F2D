{
    "contents" : "############################################################\n## SCRIPT TO PLOT NICE MAP OF AFRICA WITH MALARIAGEN POPS ##\n## HIGHLIGHTED                                            ##\n############################################################\n## LOAD MAP LIBRARIES ##\nlibrary(\"rworldmap\")\nlibrary(\"maptools\")\n###########################################################\n## LOAD DATA\n## file outlining population provenance, colours, and symbols\nmapinfo <- read.table(mapinfo_file,header=T,comment.char=\"\", as.is = T)\n\n###########################################################\n## SET UP THE MAPINFO DATAFRAME\n## make the country colour transparent?\nif(transparent_cols == T) mapinfo$colour <- makeTransparent(mapinfo$colour,alpha=175)\nmapinfo <- data.frame(mapinfo)\n## set colour to factor\nmapinfo$colour <- factor(mapinfo$colour,levels=unique(mapinfo$colour))\n## generate a vector of regions for each ethnic group\ntmpgrp <- gsub(\"MANDINKA\",\"MANDINKAII\",mapinfo$EthnicGroup)\nnewcols <- getPopRegion(tmpgrp,popkey)\nnewcols <- factor(newcols, levels=regions)\nmapinfo <- cbind(mapinfo,newcols)\ncolnames(mapinfo)[ncol(mapinfo)] <- \"region\"\n## convert to colours\nnewcols <- pcolshex[newcols]\n## add colour column to mapinfo\nmapinfo <- cbind(mapinfo,newcols)\n## BRING IN A MAP FROM THE rworldmaps PACKAGE\nnewmap <- getMap(resolution=\"low\")\n\n###########################################################\n###########################################################\n###########################################################\n## PLOT MAP WITH COUNTRY COLOURS\nif(plot_ancestry_regions == FALSE)\n{\n    newmap2 <- joinCountryData2Map(mapinfo,joinCode=\"ISO_A3\",nameJoinColumn=\"pop\",verbose=FALSE)\n    mapCountryData(newmap2,nameColumnToPlot=\"colour\",catMethod=\"categorical\",\n                   oceanCol=map_ocean_col,missingCountryCol=map_miss_col,addLegend=F,\n                   mapTitle=\"\", colourPalette=makeTransparent(levels(mapinfo$colour)),\n                   xlim=map_xlim,ylim=map_ylim)\n}\n\n###########################################################\n### OR PLOT MAP 7 REGION ANCESTRIES\nif(plot_ancestry_regions == TRUE)\n{\n    newmap2 <- joinCountryData2Map(mapinfo,joinCode=\"ISO_A3\",nameJoinColumn=\"pop\",verbose=FALSE)\n    mapCountryData(newmap2,nameColumnToPlot=\"newcols\",catMethod=\"categorical\",\n                   oceanCol=map_ocean_col,missingCountryCol=map_miss_col,addLegend=F,\n                   mapTitle=\"\",colourPalette=levels(mapinfo$newcols),\n                   xlim=map.xlim.2plot,\n                   ylim=map.ylim.2plot)\n}\n\n## PLOT EQUATOR AND TROPICS?\nif(plot_equator==T)\n{\n    abline(h=0,lwd=1)\n    abline(h=23, lty=2,lwd=1)\n    abline(h=-23, lty=2,lwd=1)\n}\n\nbox()\n\nif(plot_letter == TRUE) legend(\"bottomright\",legend=\"A\",cex=2,bty=\"n\")\n\n## PLOT POINTS, ALLOWING FOR MULTIPLE POPS FROM THE SAME COUNTRY\nif(plot_points == TRUE) newi <- plotPopPoints(latlong_file,leginfo_file,poppos_file,pt_cex=2)\n\n###########################################################\n## PLOT THREE SEPARATE LEGENDS\nif(plot_legends == TRUE)\n{\n    afr_cnts <- list(c(\"Gambia\",\"Mali\",\"BurkinaFaso\",\"Ghana\",\"Nigeria\",\"Cameroon\"),\n                     c(\"Sudan\",\"Ethiopia\",\"Somalia\",\"Kenya\"),\n                     c(\"Angola\",\"Namibia\",\"Botswana\",\"SouthAfrica\",\"Tanzania\",\"Malawi\"))\n    names(afr_cnts) <- c(\"WEST/CENTRAL\",\"EASTERN\",\"SOUTHERN\")\n    malgen_cnts <- c(\"Gambia\",\"Mali\",\"BurkinaFaso\",\"Ghana\",\"Cameroon\",\"Kenya\",\"Tanzania\",\"Malawi\")\n    for(i in 1:length(afr_cnts))\n    {\n        leginfo <-read.table(leginfo_file,header=T,comment.char=\"\")\n        legnumbers <- read.table(popnums_file,header=F)\n        legnumbers[,1] <- tidyNames(legnumbers[,1])\n        pop_nums <- c()\n        for(j in as.character(leginfo$EthnicGroup))\n        {\n            pn <- legnumbers[legnumbers$V1==j,2]\n            if(length(pn)>0)\n            {\n                pop_nums <- c(pop_nums,pn)    \n            }  else {\n                pop_nums <- c(pop_nums,\"X\")\n            }\n        }\n        leginfo <- cbind(leginfo,pop_nums)\n        leginfo <- leginfo[leginfo$Country%in%unlist(afr_cnts[i]),]\n        leginfo$Country <- factor(leginfo$Country,levels=unlist(afr_cnts[i]))\n        leginfo <- leginfo[order(leginfo$Country,leginfo$Colour,leginfo$EthnicGroup),]\n        if(i==3)\n        {\n            leginfo$Country <- factor(leginfo$Country,levels=c(\"Tanzania\",\"Malawi\",\"SouthAfrica\",\"Namibia\",\"Botswana\",\"Angola\"))\n            leginfo <- leginfo[order(leginfo$Country,decreasing=F),]\n        }\n        legrim <- rep(\"#000000\",nrow(leginfo))\n        legrim[leginfo$rim==1]  <- as.character(leginfo$Colour)[leginfo$rim==1]\n        \n        par(mar=c(0,0,0,0))\n        plot(0,0,type=\"n\",axes=F,xlab=\"\",ylab=\"\")\n        legend(\"topleft\",ncol=1,\n               legend=c(paste0(tidyNames(as.character(leginfo$EthnicGroup),khoesan=T,tig=T),\n                                               \" [\",as.character(leginfo$pop_nums),\"]\")),\n               pch=as.numeric(leginfo$poppch),\n               pt.bg=as.character(leginfo$Colour),\n               pt.cex=c(rep(pt_cex,length(leginfo$poppch)),0),\n               pt.lwd=0.5,y.intersp = 1.5,\n               col=legrim,cex=0.75,\n               text.col=as.character(leginfo$Colour),xpd=T,\n               bty=\"n\",\n               title.col=\"black\",title.adj=0)\n    }\n}    ",
    "created" : 1453723400919.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1046747478",
    "id" : "DAB79F2D",
    "lastKnownWriteTime" : 1453724202,
    "path" : "~/repos/popgen/plotting_scripts/africamap.R",
    "project_path" : "plotting_scripts/africamap.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}